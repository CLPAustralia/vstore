{% extends 'base.html.twig' %}

{% block title%}
  New Person
{% endblock%}

{% block body %}
  {{ form_start(form) }}
    {{ form_row(form.title) }}
    {{ form_row(form.firstName) }}
    {{ form_row(form.lastName) }}
    {{ form_row(form.addresses, {'attr':{'class':'addresses'}})  }}
  {{ form_end(form) }}
{% endblock %}

{% block javascripts %}

  <script src="{{ asset('js/jquery-3.1.1.js') }}"></script>

  <script type="text/javascript">
    
    jQuery(document).ready(function() {

      var $collectionHolder = $('.addresses');

      // Setup "add new address" link
      var $addAddressLink = $('<a href="#" class="add_address_link">Add an address</a>');
      var $newLinkDiv = $('<div></div>').append($addAddressLink);
      $collectionHolder.append($newLinkDiv);

      // count the current form inputs we have (e.g. 2), use that as the new
      // index when inserting a new item (e.g. 2)
      $collectionHolder.data('index', $collectionHolder.find(':input').length);

      $addAddressLink.on('click', function(e) {
        
        // prevent the link from creating a "#" on the URL
        e.preventDefault();

        var prototype = $collectionHolder.data('prototype');
        var index = $collectionHolder.data('index');

        // Replace '__name__' in the prototype's HTML to
        // instead be a number based on how many items we have
        var newForm = prototype.replace(/__name__/g, index);

        // increase the index with one for the next item
        $collectionHolder.data('index', index + 1);

        var $newFormDiv = $('<div></div>').append(newForm);
        $newLinkDiv.before($newFormDiv);

      });

    });

  </script>

{% endblock %}
